import os

# Define the path for the HTTPS nginx config file
nginx_conf_path = "nginx/conf/odoo-https.conf"

# Define the content of the HTTPS nginx configuration
nginx_https_config = """
server {
    listen 80;
    server_name odoo.timengineering.com;

    # Redirect all HTTP requests to HTTPS
    return 301 https://$host$request_uri;
}

server {
    listen 443 ssl;
    server_name odoo.timengineering.com;

    ssl_certificate /etc/letsencrypt/live/odoo.timengineering.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/odoo.timengineering.com/privkey.pem;

    location / {
        proxy_pass http://web:8069;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location /longpolling/ {
        proxy_pass http://web:8072;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
"""

# Create the nginx/conf directory if it doesn't exist
os.makedirs(os.path.dirname(nginx_conf_path), exist_ok=True)

# Write the HTTPS config to the file
with open(nginx_conf_path, "w") as f:
    f.write(nginx_https_config)

print(f"HTTPS Nginx config file has been created at: {nginx_conf_path}")

